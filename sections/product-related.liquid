<div class="product-carousel-section">
  {%- include 'product-card-styles.css' -%}
  {%- assign collection = product.collections.first -%}
  {% if collection and collection.products_count > 1 %}
  <div class="ps-section" style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
      <div class="container">
          <div class="ps-section__header">
              <h3 class="ps-section__heading">{{ section.settings.title }}</h3>
              <div class="ps-section__carousel-navigation">
                  <a class="ps-btn--carouse-arrow prev" href="#carousel-related-{{ section.id }}" aria-label="Button prev"><i class="lnil lnil-chevron-left"></i></a>
                  <a class="ps-btn--carouse-arrow next" href="#carousel-related-{{ section.id }}" aria-label="Button next"><i class="lnil lnil-chevron-right"></i></a>
              </div>
          </div>
          <div class="ps-section__content">
              <div 
                class="owl-slider ps-carousel" 
                id="carousel-related-{{ section.id }}" 
                data-owl-nav="{{ section.settings.enable_nav }}"
                data-owl-loop="{{ section.settings.enable_loop }}"
                data-owl-autoplay="{{ section.settings.enable_autoplay }}"
                data-owl-autoplay-timeout="{{ section.settings.autoplay_speed }}"
                data-owl-gap="30"
                data-owl-item="4"
                data-owl-item-xs="1"
                data-owl-item-sm="2"
                data-owl-item-md="3"
                data-owl-item-lg="4"
              >
                  {%- for related_product in collection.products limit: 8 -%}
                      {%- if related_product.handle != product.handle -%}
                          {%- render 'product-carouse', product: related_product -%}
                      {%- endif -%}
                  {%- endfor -%}
              </div>
          </div>
      </div>
  </div>
  {% endif %}
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var $carousel = $('#carousel-related-{{ section.id }}');

    if ($carousel.length && typeof $carousel.owlCarousel === 'function') {
      $carousel.owlCarousel({
        loop: {{ section.settings.enable_loop | default: false }},
        nav: {{ section.settings.enable_nav | default: false }},
        autoplay: {{ section.settings.enable_autoplay | default: false }},
        autoplayTimeout: {{ section.settings.autoplay_speed | default: 5000 }},
        margin: 30,
        responsive: {
          0: { items: 1 },
          576: { items: 2 },
          768: { items: 3 },
          1024: { items: 4 }
        }
      });

      // Botones externos
      $('.ps-btn--carouse-arrow.prev[href="#carousel-related-{{ section.id }}"]').on('click', function(e) {
        e.preventDefault();
        $carousel.trigger('prev.owl.carousel');
      });
      $('.ps-btn--carouse-arrow.next[href="#carousel-related-{{ section.id }}"]').on('click', function(e) {
        e.preventDefault();
        $carousel.trigger('next.owl.carousel');
      });
    }
  });
</script>


{% schema %}
{
  "name": "Related Products",
  "settings": [
    { "type": "text", "id": "title", "default": "También te puede interesar", "label": "Título" },

    { "type": "checkbox", "id": "enable_autoplay", "label": "Activar autoplay", "default": true },
    { "type": "range", "id": "autoplay_speed", "label": "Velocidad del autoplay (ms)", "min": 1000, "max": 9500, "step": 500, "unit": "ms", "default": 5000 },
    { "type": "checkbox", "id": "enable_loop", "label": "Habilitar loop infinito", "default": true },
    { "type": "checkbox", "id": "enable_nav", "label": "Mostrar botones de navegación", "default": true },

    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 5, "unit": "px", "label": "Padding Top", "default": 50 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 5, "unit": "px", "label": "Padding Bottom", "default": 50 }
  ]
}
{% endschema %}

