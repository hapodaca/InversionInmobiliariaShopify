name: Sync Shopify Theme to GitHub

on:
  # Ejecutar autom√°ticamente cada 6 horas
  schedule:
    - cron: '0 */6 * * *'  # Cada 6 horas

  # Permitir ejecuci√≥n manual desde GitHub
  workflow_dispatch:

jobs:
  sync-theme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
          bundler-cache: false

      - name: Install Theme Kit
        run: |
          curl -s https://shopify.github.io/themekit/scripts/install.py | python3

      - name: Pull theme from Shopify
        run: |
          theme get --password=${{ secrets.SHOPIFY_CLI_TOKEN }} --store=${{ secrets.SHOPIFY_STORE }} --themeid=${{ secrets.SHOPIFY_THEME_ID }} --dir=.

      - name: Check for changes
        id: check_changes
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"

          if [[ -n $(git status -s) ]]; then
            echo "has_changes=true" >> $GITHUB_OUTPUT
            echo "‚úÖ Cambios detectados desde Shopify"
          else
            echo "has_changes=false" >> $GITHUB_OUTPUT
            echo "‚ÑπÔ∏è No hay cambios nuevos"
          fi

      - name: Commit and push changes
        if: steps.check_changes.outputs.has_changes == 'true'
        run: |
          git add .
          git commit -m "ü§ñ Auto-sync: Cambios desde Shopify ($(date +'%Y-%m-%d %H:%M:%S'))"
          git push
